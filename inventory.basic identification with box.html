<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ç‰©ä»¶è¾¨è­˜å™¨</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #111;
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }
        h1 {
            color: white;
            position: absolute;
            top: 20px;
            z-index: 10;
            font-size: 18px;
            background: rgba(0,0,0,0.5);
            padding: 5px 10px;
            border-radius: 8px;
        }
        #cam-container {
            position: relative;
            width: 100%;
            max-width: 640px;
            height: 480px;
        }
        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
        }
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #loading {
            color: #00ffcc;
            font-size: 20px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        .footer {
            position: absolute;
            bottom: 20px;
            color: #888;
            font-size: 12px;
        }
    </style>
</head>
<body>

    <h1>ğŸ‘ï¸ Edge AI ç‰©ä»¶è¾¨è­˜</h1>
    
    <div id="loading">
        æ­£åœ¨è¼‰å…¥ AI æ¨¡å‹...<br>
        <span style="font-size:12px; color:#aaa;">(åˆæ¬¡è¼‰å…¥éœ€æ™‚ç´„ 10-20 ç§’)</span>
    </div>

    <div id="cam-container" style="display:none;">
        <video id="webcam" autoplay playsinline muted></video>
        <canvas id="canvas"></canvas>
    </div>

    <div class="footer">Powered by TensorFlow.js</div>

    <script>
        const video = document.getElementById('webcam');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const container = document.getElementById('cam-container');
        const loading = document.getElementById('loading');
        
        let model = undefined;

        // 1. è¼‰å…¥æ¨¡å‹
        async function loadModel() {
            // ä½¿ç”¨ coco-ssd é è¨“ç·´æ¨¡å‹ (å¯ä»¥è¾¨è­˜ 80 ç¨®å¸¸è¦‹ç‰©ä»¶ï¼šäººã€è²“ã€ç‹—ã€æ¯ã€è»Š...)
            model = await cocoSsd.load();
            console.log("Model loaded!");
            startCamera();
        }

        // 2. é–‹å•Ÿç›¸æ©Ÿ
        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' }, // å„ªå…ˆä½¿ç”¨å¾Œç½®é¡é ­
                    audio: false
                });
                video.srcObject = stream;
                
                // ç­‰å¾…å½±ç‰‡é–‹å§‹æ’­æ”¾
                video.onloadeddata = () => {
                    loading.style.display = 'none';
                    container.style.display = 'block';
                    // è¨­å®š Canvas å¤§å°èˆ‡ Video ä¸€è‡´
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    // é–‹å§‹é æ¸¬
                    predictLoop();
                };
            } catch (error) {
                alert("ç„¡æ³•å­˜å–ç›¸æ©Ÿï¼Œè«‹ç¢ºä¿å·²æˆæ¬Šã€‚");
                console.error(error);
            }
        }

        // 3. AI é æ¸¬å¾ªç’°
        async function predictLoop() {
            if (!model) return;

            // è®“ AI åˆ†æç›®å‰çš„ video ç•«é¢
            const predictions = await model.detect(video);
            
            // æ¸…ç©ºç•«å¸ƒï¼Œæº–å‚™ç•«æ–°çš„æ¡†
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç•«å‡ºæ¯ä¸€å€‹é æ¸¬çµæœ
            predictions.forEach(prediction => {
                // ç•«æ¡†æ¡†
                ctx.beginPath();
                ctx.rect(...prediction.bbox);
                ctx.lineWidth = 2;
                ctx.strokeStyle = '#00ffcc'; // è¢å…‰ç¶ è‰²
                ctx.fillStyle = '#00ffcc';
                ctx.stroke();
                
                // å¯«æ–‡å­— (ç‰©ä»¶åç¨± + æº–ç¢ºåº¦)
                ctx.font = '16px Arial';
                ctx.fillText(
                    `${prediction.class} (${Math.round(prediction.score * 100)}%)`,
                    prediction.bbox[0],
                    prediction.bbox[1] > 10 ? prediction.bbox[1] - 5 : 10
                );
            });

            // ä¸æ–·é‡è¤‡ä¸‹ä¸€å¹€
            requestAnimationFrame(predictLoop);
        }

        // å•Ÿå‹•ç¨‹å¼
        loadModel();
    </script>
</body>
</html>
